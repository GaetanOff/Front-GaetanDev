<app-templadmin>
  <div class="flex-1 p-8">
    <h1 class="text-3xl font-bold mb-6">Proxy List</h1>
    <p class="text-gray-600 mb-4">
      Last refresh:
      <span *ngIf="isLoading">loading...</span>
      <span *ngIf="!isLoading">{{ lastRefresh }}</span>
    </p>
    <div class="flex flex-col md:flex-row justify-center md:justify-between">
      <div class="w-1/2 p-4">
        <h2 class="text-2xl font-bold mb-4">HTTP Proxies</h2>
        <div class="w-full bg-gray-100 text-gray-900 mt-2 p-3 rounded-lg min-h-[120px] overflow-auto" *ngIf="!isLoading">
          <ul>
            <li *ngFor="let proxy of httpProxies.slice(0, 15)">{{ proxy.host }}:{{ proxy.port }}</li>
            <li class="italic pt-2">... {{httpProxies.length}} more</li>
          </ul>
        </div>
        <div *ngIf="isLoading">
          <app-refresh-proxies-whitelist></app-refresh-proxies-whitelist>
        </div>
      </div>
      <div class="w-1/2 p-4">
        <h2 class="text-2xl font-bold mb-4">SOCKS5 Proxies</h2>
        <div class="w-full bg-gray-100 text-gray-900 mt-2 p-3 rounded-lg min-h-[120px] overflow-auto" *ngIf="!isLoading">
          <ul>
            <li *ngFor="let proxy of socks5Proxies.slice(0, 15)">{{ proxy.host }}:{{ proxy.port }}</li>
            <li class="italic pt-2">... {{socks5Proxies.length}} more</li>
          </ul>
        </div>
        <div *ngIf="isLoading">
          <app-refresh-proxies-whitelist></app-refresh-proxies-whitelist>
        </div>
      </div>
    </div>

    <div class="w-full p-4 mt-6 rounded-lg">
      <h2 class="text-2xl font-bold mb-4">Download Proxies with Filters</h2>

      <div class="flex flex-col md:flex-row gap-4">
        <div class="w-full md:w-1/3">
          <label class="block text-sm font-semibold mb-1">Select Country</label>
          <div class="relative">
            <select [(ngModel)]="selectedCountry" class="w-full bg-gray-300 text-gray-900 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none">
              <option *ngFor="let country of countries" [value]="country">{{ country }}</option>
            </select>
            <div class="absolute inset-y-0 right-3 flex items-center pointer-events-none">
              ▼
            </div>
          </div>
        </div>

        <div class="w-full md:w-1/3">
          <label class="block text-sm font-semibold mb-1">Proxy Type</label>
          <div class="relative">
            <select [(ngModel)]="selectedProxyType" (ngModelChange)="updateCountryList()"
                    class="w-full bg-gray-300 text-gray-900 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none">
              <option value="http">HTTP</option>
              <option value="socks5">SOCKS5</option>
            </select>
            <div class="absolute inset-y-0 right-3 flex items-center pointer-events-none">
              ▼
            </div>
          </div>
        </div>

        <div class="w-full md:w-1/3">
          <label class="block text-sm font-semibold mb-1">Number of Proxies</label>
          <input type="number" [(ngModel)]="proxyLimit" min="1" max="1000" class="w-full bg-gray-300 text-gray-900 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>
      </div>

      <button (click)="downloadFilteredProxies()" class="px-4 py-2 mt-4 bg-blue-500 hover:bg-blue-600 duration-300 text-white rounded-md w-full hover:bg-blue-600 transition">
        Download Filtered Proxies
      </button>
    </div>
  </div>

</app-templadmin>
